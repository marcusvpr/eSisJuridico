<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
    xmlns:o="http://omnifaces.org/ui"
	template="/WEB-INF/template/sentinel/mpTemplate.xhtml">

	<ui:define name="content">

		<f:metadata>
			<o:viewParam name="mpUsuario" value="#{mpCadastroUsuarioBean.mpUsuario}" />
			<f:viewAction action="#{mpCadastroUsuarioBean.inicializar}" />
		</f:metadata>

		<div class="ContainerIndent">
			<h:form id="frm">
				<p:panel header="Usuário #{mpCadastroUsuarioBean.txtModoTela}">

					<p:messages id="message" autoUpdate="false" showDetail="false" />

					<ui:include src="/WEB-INF/template/sentinel/mpBotoesUsuario.xhtml" />

					<div class="ContainerIndent" style="margin-top: 60px;">
						<h:panelGroup>
							<p:outputLabel value="Login: "
								rendered="#{mpLoginBean.scIndLabelCampo}" />

							<p:commandButton id="cbNome" icon="fa fa-fw fa-search-plus"
								process="@this" title="Pesquisa Usuário por Login"
            					action="#{mpCadastroUsuarioBean.findByNome}" update="frmFind"
								oncomplete="PF('findUsuarioDialog').show()" />
        				
							<p:inputText id="login" placeholder="Login"
								styleClass="Container40 Fnone MarAuto Fs16"
								required="#{mpCadastroUsuarioBean.indEditavel}"
								validatorMessage="Informar Login"
								readonly="#{mpCadastroUsuarioBean.indEditavel}"
								value="#{mpCadastroUsuarioBean.mpUsuario.login}" />
							<p:tooltip for="login" value="Login (Ex.: fulano )" />
						</h:panelGroup>
					</div>

					<p:tabView id="tabViewU">

						<p:tab title="Dados">
							<div class="ContainerIndent ui-fluid">
								<p:panel>
									<div class="Container">
										<div class="Container95 Responsive100">
											<div class="Container100">
												<p:panelGrid columns="3" layout="grid"
													style="border:0px !important; background:none;"
													styleClass="ui-panelgrid-blank">
													<h:panelGroup>
														<p:outputLabel value="Nome: "
															rendered="#{mpLoginBean.scIndLabelCampo}" />
														<p:inputText id="nome" placeholder="Nome"
															required="#{mpCadastroUsuarioBean.indEditavel}"
															validatorMessage="Informar Nome"
															readonly="#{mpCadastroUsuarioBean.indEditavel}"
															value="#{mpCadastroUsuarioBean.mpUsuario.nome}" />
														<p:tooltip for="nome" value="Nome (Ex.: Fulano da Silva )" />
													</h:panelGroup>
													<h:panelGroup>
														<h:panelGroup>
															<p:outputLabel value="Senha: "
																rendered="#{mpLoginBean.scIndLabelCampo}" />
															<p:inputText id="senha" placeholder="Senha"
																required="#{mpCadastroUsuarioBean.indEditavel}"
																validatorMessage="Informar Senha" style="width:50px;"
																readonly="#{mpCadastroUsuarioBean.indEditavel}"
																value="#{mpCadastroUsuarioBean.mpUsuario.senha}" />
															<p:tooltip for="senha" value="Senha (Ex.: @Letras123 )" />
														</h:panelGroup>
														<p:spacer width="20px" />
														<p:outputLabel value="Ambiente" for="tenant" />
														<p:spacer width="5px" />
														<p:inputText id="tenant" size="4"
															disabled="#{mpCadastroUsuarioBean.indEditavel}"
															readonly="#{mpSeguranca.isAdministradores() ? false : true}"
															style="color:blue; width:80px; align:center;"
															value="#{mpCadastroUsuarioBean.mpUsuario.tenantId}" />
													</h:panelGroup>
													<h:panelGroup>
														<p:outputLabel value="E-mail: "
															rendered="#{mpLoginBean.scIndLabelCampo}" />
														<p:inputText id="email" placeholder="E-mail"
															required="#{mpCadastroUsuarioBean.indEditavel}"
															validatorMessage="Informar E-mail"
															readonly="#{mpCadastroUsuarioBean.indEditavel}"
															value="#{mpCadastroUsuarioBean.mpUsuario.email}" />
														<p:tooltip for="email" value="E-mail (Ex.: fulano@provedor.com.br )" />
													</h:panelGroup>
													<h:panelGroup>
														<p:outputLabel value="Dt.Nascimento: "
															rendered="#{mpLoginBean.scIndLabelCampo}" />
														<p:calendar id="dtNasc" pattern="dd/MM/yyyy"  mask="true"
															placeholder="Data Nascimento" effect="fold"
															disabled="#{mpCadastroUsuarioBean.indEditavel}"
															value="#{mpCadastroUsuarioBean.mpUsuario.dataNascimento}" />
														<p:tooltip for="dtNasc" value="Data Nascimento (Ex.: 31/03/1961 )" />
													</h:panelGroup>
													<h:panelGroup>
														<p:outputLabel value="Status: "
															rendered="#{mpLoginBean.scIndLabelCampo}" />
														<p:selectOneMenu id="status" effect="fold"
															required="#{mpCadastroUsuarioBean.indEditavel}"
															validatorMessage="Informar Status"
															disabled="#{mpCadastroUsuarioBean.indEditavel}"
															value="#{mpCadastroUsuarioBean.mpUsuario.mpStatus}">
															<f:selectItem itemLabel="Selecione o Status" />
															<f:selectItems
																value="#{mpCadastroUsuarioBean.mpStatusList}"
																var="mpStatus" itemLabel="#{mpStatus.descricao}"
																itemValue="#{mpStatus}" />
														</p:selectOneMenu>
														<p:tooltip for="status" value="Status (Ex.: Ativo )" />
													</h:panelGroup>
													<h:panelGroup>
														<p:outputLabel value="Sexo: "
															rendered="#{mpLoginBean.scIndLabelCampo}" />
														<p:selectOneRadio
															layout="responsive" columns="2"
															required="#{mpCadastroUsuarioBean.indEditavel}"
															validatorMessage="Informar Sexo"
															disabled="#{mpCadastroUsuarioBean.indEditavel}"
															value="#{mpCadastroUsuarioBean.mpUsuario.mpSexo}">
															<f:selectItems layout="responsive" columns="2"
																value="#{mpCadastroUsuarioBean.mpSexoList}" var="mpSexo"
																itemLabel="#{mpSexo.descricao}" itemValue="#{mpSexo}" />
														</p:selectOneRadio>
													</h:panelGroup>
													<h:panelGroup>
														<p:outputLabel value="Telefone/Celular: "
															rendered="#{mpLoginBean.scIndLabelCampo}" />
														<p:inputText id="celular" placeholder="Telefone/Celular"
															readonly="#{mpCadastroUsuarioBean.indEditavel}"
															value="#{mpCadastroUsuarioBean.mpUsuario.celular}" />
														<p:tooltip for="celular" value="Telefone/Celular (Ex.: (21)91234-5678 )" />
													</h:panelGroup>
													<h:panelGroup>
														<p:outputLabel value="Observação: "
															rendered="#{mpLoginBean.scIndLabelCampo}" />
														<p:inputTextarea id="obs" placeholder="Observação"
															readonly="#{mpCadastroUsuarioBean.indEditavel}" rows="2"
															value="#{mpCadastroUsuarioBean.mpUsuario.observacao}" />
														<p:tooltip for="obs" value="Observação" />
													</h:panelGroup>
													<p:spacer />
												</p:panelGrid>
											</div>
										</div>
										<div class="Container5 Responsive100">
											<div class="Container100">
												<div class="ContainerIndent"></div>
											</div>
										</div>
									</div>
								</p:panel>
							</div>
						</p:tab>

						<p:tab title="Grupos">
							<div class="ContainerIndent ui-fluid">
								<p:panel>
									<div class="Container">
										<div class="Container90 Responsive100">
											<div class="Container100">
												<p:panelGrid columns="2" layout="grid"
													style="border:0px !important; background:none;"
													styleClass="ui-panelgrid-blank">
													<p:selectManyCheckbox
														layout="responsive" columns="1"
														converter="mpGrupoConverterX"
														disabled="#{mpCadastroUsuarioBean.indEditavel}"
														value="#{mpCadastroUsuarioBean.mpUsuario.mpGrupos}">
														<f:attribute name="collectionType"
															value="java.util.ArrayList" />
														<f:selectItems
															value="#{mpCadastroUsuarioBean.mpGrupoList}"
															var="mpGrupo" itemLabel="#{mpGrupo.descricao}"
															itemValue="#{mpGrupo}" />
													</p:selectManyCheckbox>
													<p:spacer />
												</p:panelGrid>
											</div>
										</div>
										<div class="Container10 Responsive100">
											<div class="Container100">
												<div class="ContainerIndent"></div>
											</div>
										</div>
									</div>
								</p:panel>
							</div>
						</p:tab>

						<p:tab title="Foto">
							<p:messages id="messageFoto" autoUpdate="false" showDetail="false" />
							<div class="ContainerIndent ui-fluid">
								<p:panel>
									<div class="Container">
										<div class="Container50 Responsive100">
											<div class="Container100">

												<h:panelGroup id="arquivoBD">
													<p:outputLabel style="font-size:16px; color:blue;"
														value="#{mpCadastroUsuarioBean.mpUsuario.mpArquivoAcao.resultado}" />
													<p:spacer width="5" />
													<o:graphicImage dataURI="true" cache="false" width="200"
														rendered="#{mpCadastroUsuarioBean.arquivoBytes == null ? false : true}"
														value="#{mpCadastroUsuarioBean.arquivoBytes}" />
												</h:panelGroup>

											</div>
										</div>
										<div class="Container50 Responsive100">
											<div class="Container100">
												<div class="ContainerIndent">
													<p:panelGrid id="pGridFoto" columns="2"
														styleClass="panelgrid-noborder" layout="grid"
														columnClasses="ui-grid-col-2, ui-grid-col-10">

														<p:outputLabel value="Ação" for="arquivoAcao"
															style="font-size:14px; color:black;" />
														<p:selectOneRadio id="arquivoAcao"
															disabled="#{mpCadastroUsuarioBean.indEditavel}"
															value="#{mpCadastroUsuarioBean.mpArquivoAcao}"
															valueChangeListener="#{mpCadastroUsuarioBean.arquivoAcaoSelecionado}">
															<f:selectItems
																value="#{mpCadastroUsuarioBean.mpArquivoAcaoList}"
																var="mpArquivoAcao" itemValue="#{mpArquivoAcao}"
																itemLabel="#{mpArquivoAcao.descricao}" />
															<f:ajax execute="@all" render="@all" />
														</p:selectOneRadio>

														<p:outputLabel value="Associar" for="associaFoto"
															rendered="#{mpCadastroUsuarioBean.arquivoAcaoSelecao == 'Associar'}" />
														<p:selectOneMenu id="associaFoto"
															disabled="#{mpCadastroUsuarioBean.indEditavel}"
															value="#{mpCadastroUsuarioBean.mpUsuario.mpArquivoBD}"
															rendered="#{mpCadastroUsuarioBean.arquivoAcaoSelecao == 'Associar'}">
															<f:selectItem itemLabel="Selecione a Arquivo" />
															<f:selectItems
																value="#{mpCadastroUsuarioBean.mpArquivoBDList}"
																var="mpArquivoBD" itemValue="#{mpArquivoBD}"
																itemLabel="#{mpArquivoBD.descricao}" />
															<p:ajax event="change" process="@this"
																update="frm:tabViewU:arquivoBD"
																listener="#{mpCadastroUsuarioBean.associaMpArquivoBD}"
																ignoreAutoUpdate="true" />
														</p:selectOneMenu>

													</p:panelGrid>

													<h:panelGroup id="carregaImagem"
														rendered="#{mpCadastroUsuarioBean.arquivoAcaoSelecao == 'Carregar'}">
														<p:fileUpload label="Selecionar..."
															disabled="#{mpCadastroUsuarioBean.indEditavel}"
															update="frm:tabViewU:messageFoto frm:tabViewU:arquivoBD"
															fileUploadListener="#{mpCadastroUsuarioBean.handleFileUpload}"
															auto="true" mode="advanced" dragDropSupport="true"
															sizeLimit="5000000"
															allowTypes="/(\.|\/)(gif|jpe?g|png)$/" />
													</h:panelGroup>

													<p:commandButton value="Proceder Captura"
														icon="fa fa-camera Fs14 white"
														rendered="#{mpCadastroUsuarioBean.arquivoAcaoSelecao == 'Capturar'}"
														oncomplete="PF('capturaDialog').show()" process="@this">
													</p:commandButton>

												</div>
											</div>
										</div>
									</div>
								</p:panel>
							</div>
						</p:tab>

					</p:tabView>
				</p:panel>
			</h:form>
		</div>

		<div class="ContainerIndent">
			<p:dialog widgetVar="capturaDialog" id="capturaDialogId" modal="true"
				header="Captura Foto" showEffect="fade" hideEffect="fade"
				resizable="false" responsive="true"
				rendered="#{mpCadastroUsuarioBean.arquivoAcaoSelecao == 'Capturar'}">
				<h:form id="frmCapturaDialog">
					<h:panelGrid columns="3" cellpadding="5">
						<p:photoCam widgetVar="pc" width="250"
							listener="#{mpCadastroUsuarioBean.aoCapturarArquivo}"
							update="photoDialog frm:tabViewU:arquivoBD" />
						<p:commandButton type="button" value="Capturar" icon="fa fa-camera Fs14 white"
							onclick="PF('pc').capture()" />
						<p:outputPanel id="photoDialog">
							<o:graphicImage dataURI="true" cache="false" width="250"
								rendered="#{mpCadastroUsuarioBean.arquivoBytesC == null ? false : true}"
								value="#{mpCadastroUsuarioBean.arquivoBytesC}" />
						</p:outputPanel>
					</h:panelGrid>
				</h:form>
			</p:dialog>
		</div>

        <div class="ContainerIndent">
		  <h:form id="frmFind">
			<p:dialog widgetVar="findUsuarioDialog" id="findUsuarioDialogId"
					header="Localiza - Usuario" modal="true"
        			width="300" height="50" contentWidth="100%"  contentHeight="100%"
			 		showEffect="fade" hideEffect="fade" resizable="false" responsive="true">
			 			 		
				<h:panelGroup id="findUsuarioPanel">
					<p:panelGrid id="pGridFind" columns="3" styleClass="panelgrid-noborder" layout="grid"
						columnClasses="ui-grid-col-3, ui-grid-col-10">
       					<p:autoComplete id="acNome" minQueryLength="2" effect="fade"
      					 	value="#{mpCadastroUsuarioBean.nomeFind}" scrollHeight="350"
       					 	completeMethod="#{mpCadastroUsuarioBean.completaFindByNome}">
            				<p:ajax event="itemSelect" update=":frm"
            					listener="#{mpCadastroUsuarioBean.onNomeSelecionado}"
								oncomplete="PF('findUsuarioDialog').hide()" />
        				</p:autoComplete>
        				<h:panelGroup />																		
        				<h:panelGroup />																		
					</p:panelGrid>
				</h:panelGroup>
			</p:dialog>
		  </h:form>
		</div>

	</ui:define>

</ui:composition>